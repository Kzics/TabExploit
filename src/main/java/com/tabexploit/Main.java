package com.tabexploit;

import com.destroystokyo.paper.event.server.AsyncTabCompleteEvent;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.plugin.java.JavaPlugin;

public class Main extends JavaPlugin implements Listener {

    WebhookAntiCrash webhookAntiCrash;

    @Override
    public void onEnable() {
        webhookAntiCrash = new WebhookAntiCrash("https://discord.com/api/webhooks/1218246602196648037/-3jWQR2HdhbPWSpKBJ84PbdRf3MPCPNk6K2t366zsxso0ukVXCs4Pocnq1W2UlQVWD-x");
        getServer().getPluginManager().registerEvents(this,this);
    }

    @EventHandler
    public void onTab(AsyncTabCompleteEvent event) {
        if(!(event.getSender() instanceof Player)) return;
        String buffer = event.getBuffer();
        if ((buffer.split(" ").length == 1 && !buffer.endsWith(" ")) || !buffer.startsWith("/")) {
            webhookAntiCrash.sendMessage(String.format("%s sent suspicious tabcomplete packet!", event.getSender().getName()),(Player)event.getSender());
            event.setCancelled(true);
        }
    }
}
